<head>
<title> Open Watcom 1.9 Heap Walker </title>
</head>
<body>
<h1 id="Index_of_Topics"> Index of Topics </h1>
<dl>
<dt>- A -
<dd><a href="#Allocate_All_Memory">Allocate All Memory</a>
<br><a href="#Allow_Multiple_Memory_Display_Windows">Allow Multiple Memory Display Windows</a>
<br><a href="#Auto_Position_Memory_Info_Window">Auto Position Memory Info Window</a>
<dt><br>- C -
<dd><a href="#Calculating_Memory_Size">Calculating Memory Size</a>
<br><a href="#Changing_the_Heap_Walker_Display">Changing the Heap Walker Display</a>
<br><a href="#Compact_and_Local_Walk">Compact and Local Walk</a>
<br><a href="#Compacting_the_Global_Heap">Compacting the Global Heap</a>
<br><a href="#Configuring_the_Heap_Walker_Session">Configuring the Heap Walker Session</a>
<dt><br>- D -
<dd><a href="#Discarding_an_Object">Discarding an Object</a>
<br><a href="#Display_Heap_Information">Display Heap Information</a>
<br><a href="#Display_Memory_Info_Window">Display Memory Info Window</a>
<br><a href="#Display_Resources">Display Resources</a>
<dt><br>- E -
<dd><a href="#The_Entire_Heap">The Entire Heap</a>
<dt><br>- F -
<dd><a href="#Finding_a_Selector">Finding a Selector</a>
<br><a href="#Free_All_Memory">Free All Memory</a>
<br><a href="#Free_Items_List">Free Items List</a>
<dt><br>- G -
<dd><a href="#GDI_Local_Walk">GDI Local Walk</a>
<dt><br>- H -
<dd><a href="#Heap_Walker">Heap Walker</a>
<br><a href="#The_Heap_Walker_Menu_Bar">The Heap Walker Menu Bar</a>
<br><a href="#Heap_Walker__Configuring_the_File_Name_Paths">Heap Walker:&nbsp; Configuring the File Name Paths</a>
<br><a href="#Heap_Walker__Configuring_Window_Behaviour">Heap Walker:&nbsp; Configuring Window Behaviour</a>
<br><a href="#Heap_Walker__Saving_the_Current_Configuration">Heap Walker:&nbsp; Saving the Current Configuration</a>
<br><a href="#Heap_Walker__Setting_the_Font">Heap Walker:&nbsp; Setting the Font</a>
<dt><br>- I -
<dd><a href="#Information_Dialog_Boxes">Information Dialog Boxes</a>
<dt><br>- L -
<dd><a href="#Local_Walk">Local Walk</a>
<br><a href="#LRU_Items_List">LRU Items List</a>
<dt><br>- M -
<dd><a href="#The_Memory_Display_Window">The Memory Display Window</a>
<br><a href="#Monitoring_Data_Segment_Usage">Monitoring Data Segment Usage</a>
<dt><br>- O -
<dd><a href="#Other_Allocation_Functions">Other Allocation Functions</a>
<dt><br>- Q -
<dd><a href="#Quitting_Heap_Walker">Quitting Heap Walker</a>
<dt><br>- R -
<dd><a href="#Refresh_the_Heap">Refresh the Heap</a>
<br><a href="#Refreshing_the_Global_Heap">Refreshing the Global Heap</a>
<br><a href="#Removing_Discardable_Objects">Removing Discardable Objects</a>
<br><a href="#Repositioning_an_Object">Repositioning an Object</a>
<dt><br>- S -
<dd><a href="#Save_Main_Window_SizeDPosition">Save Main Window Size/Position</a>
<br><a href="#Save_Memory_Window_SizeDPosition">Save Memory Window Size/Position</a>
<br><a href="#Saving_Heap_Walker_Information_to_a_File">Saving Heap Walker Information to a File</a>
<br><a href="#The_Selector_List">The Selector List</a>
<br><a href="#Setting_the_Offset_in_the_Memory_Display_Window">Setting the Offset in the Memory Display Window</a>
<br><a href="#Sorting_the_Lists">Sorting the Lists</a>
<br><a href="#Sorting_the_Local_Heap">Sorting the Local Heap</a>
<br><a href="#Starting_Heap_Walker">Starting Heap Walker</a>
<dt><br>- T -
<dd><a href="#Testing_with_Heap_Walker">Testing with Heap Walker</a>
<dt><br>- U -
<dd><a href="#USER_Local_Walk">USER Local Walk</a>
<br><a href="#Using_Heap_Walker">Using Heap Walker</a>
<dt><br>- V -
<dd><a href="#Viewing_an_Object_s_Memory">Viewing an Object's Memory</a>
<br><a href="#Viewing_Memory_Management_Information">Viewing Memory Management Information</a>
<br><a href="#Viewing_the_Contents_of_Memory">Viewing the Contents of Memory</a>
<br><a href="#Viewing_the_Global_Heap_Summary">Viewing the Global Heap Summary</a>
<dt><br>- W -
<dd><a href="#Walking_the_Global_Heap">Walking the Global Heap</a>
<br><a href="#Walking_the_Local_Heap">Walking the Local Heap</a>
<br><a href="#Working_with_Individual_Objects">Working with Individual Objects</a>
<br><a href="#Working_with_the_Global_Heap">Working with the Global Heap</a>
</dl>
<h1 id="Heap_Walker"> Heap Walker </h1>
<br>The Open Watcom Heap Walker is a testing and debugging tool for Windows.&nbsp; It allows you to do two things:
<ul>
<li>observe how memory is being used
<li>view the contents of memory
</ul>
<dl>
<dt>Note:
<dd>Under Windows NT, the Heap Walker monitors only the memory used by 16-bit Windows applications.
</dl>
<br>Heap Walker enables you to locate corrupted data and allows you to manipulate stored memory for testing purposes.&nbsp;
 In addition to these functions, this tool allows you to optimize your memory usage.
<br><br>Heap Walker displays the stored memory, or objects, in the Heap Walker window.&nbsp; Objects are blocks of memory
 that go together to make up the global heap.&nbsp; The objects may contain information such as program instructions, data,
 or program resources.&nbsp; You control Heap Walker using the items from the menu bar.
<h2 id="Using_Heap_Walker"> Using Heap Walker </h2>
<br>This section discusses the following topics:
<ul>
<li>Starting Heap Walker
<li>Quitting Heap Walker
<li>The Heap Walker Menu Bar
</ul>
<h3 id="Starting_Heap_Walker"> Starting Heap Walker </h3>
<br>To start Heap Walker, double click on the Heap Walker icon.&nbsp; This opens the Heap Walker window.&nbsp; The information
 list displayed is the last list that was viewed during the previous Heap Walker session.
<br><br><tt><img src="hw1.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 1.</i></b><b><i></i></b><b> The Heap Walker window displays lists of memory objects</b>
<h3 id="Quitting_Heap_Walker"> Quitting Heap Walker </h3>
<br>To close the Heap Walker session, choose Exit from the File menu of the Heap Walker window.
<h3 id="The_Heap_Walker_Menu_Bar"> The Heap Walker Menu Bar </h3>
<br>The menu bar consists of the following eight menus:
<dl>
<dt>File
<dd>Save to a file and configure the session
<dt><br>Display
<dd>Select the type of information you want to appear on the Heap Walker window
<dt><br>Sort
<dd>Select how you want to sort the information in the Heap Walker window
<dt><br>Object
<dd>Work with the items in the Heap Walker window by viewing, removing, and reordering them
<dt><br>Local
<dd>Work with Local Heaps
<dt><br>Global
<dd>Work with the Global Heap
<dt><br>Alloc
<dd>Allocate blocks of memory for testing purposes
<dt><br>Help
<dd>Access on-line help information
</dl>
<h2 id="Configuring_the_Heap_Walker_Session"> Configuring the Heap Walker Session </h2>
<br>There are many aspects of Heap Walker that you can configure, including setting the fonts, window positions, and save
 paths.&nbsp; Choose the Configure item from the File menu.&nbsp; This opens the Heap Walker Configuration dialog box where
 you customize the Heap Walker's behavior.
<br><br><tt><img src="hw2.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 2.</i></b><b><i></i></b><b> On the Heap Walker Configuration dialog, you customize the Heap Walker's behavior</b>
<br><br>The Configuration dialog is set up with defaults for all options.&nbsp; To reset all options to their defaults, click
 the Defaults button.
<h3 id="Heap_Walker__Configuring_the_File_Name_Paths"> Heap Walker:&nbsp; Configuring the File Name Paths </h3>
<br>The Heap Walker window, the local heap window and the memory display windows all have file menus with save items.&nbsp;
 When you choose the save item one in these windows the currently displayed information is saved to a filename generated by
 heapwalker.
<br><br>These file names are generated based on the entries in the File name for...&nbsp; fields of the Configuration Dialog.
&nbsp; The File name for Global Saves affects filename generation for saves from the Heap Walker window.&nbsp; The File name
 for Local Saves affects filename generation for saves from the local walk window.&nbsp; The File name for Memory Dumps affects
 filename generation for saves from the memory display window.
<br><br>The file names for saves are generated from the entered file name as follows.&nbsp; If a path is specified for the
 filename then the generated file will appear in the specified directory.&nbsp; The filename for the generated file is formed
 by adding three digits to the end of the specified file name to form a new filename that is unique in the given directory.
<br><br>For example, if the File name for Memory Dumps field contains &quot;c:\mem\foo.txt&quot; then all files saved from
 the memory display window appear in the directory c:\mem and have filenames such as &quot;foo000.txt&quot;, &quot;foo001.txt&quot;
 and &quot;foo003.txt&quot;.
<br><br>Beside each file name field in the configuration dialog is a Browse button.&nbsp; Pressing this button opens a file
 selection dialog where you can view your directory structure while picking the filename for that field.
<h3 id="Heap_Walker__Configuring_Window_Behaviour"> Heap Walker:&nbsp; Configuring Window Behaviour </h3>
<br>As well as file name options, the Configuration dialog contains six configuration options that you activate and de-activate
 using check boxes.&nbsp; A description of each option follows.
<h4 id="Save_Main_Window_SizeDPosition"> Save Main Window Size/Position </h4>
<br>Activating this option causes the size and position of the Heap Walker window to be saved when you close the application.
&nbsp; The next time you open the Heap Walker application, the window appears with the same size and same position as when
 you last closed it.
<h4 id="Save_Memory_Window_SizeDPosition"> Save Memory Window Size/Position </h4>
<br>Activating this option causes the size and position of the Memory Display window to be saved when you close the application.
&nbsp; The next time you open the Memory Display window, it appears with the same size and same position as when you last
 closed it.
<h4 id="Allow_Multiple_Memory_Display_Windows"> Allow Multiple Memory Display Windows </h4>
<br>When this option is activated, you can open multiple Memory Display windows.&nbsp; The new window may open on top of an
 existing window, but can be moved and resized as necessary.
<br><br>When this option is not activated, selecting a second object to view from the Heap Walker window closes the first
 Memory Display window and opens the new Memory Display window in its place.
<h4 id="Display_Memory_Info_Window"> Display Memory Info Window </h4>
<br>When this option is selected a Handle Information or Selector Information dialog box appears whenever a Memory Display
 window is opened.&nbsp; If this option is not activated the information box does not appear, but it can be opened by choosing
 Show Info from the File menu in the Memory Display window.
<h4 id="Auto_Position_Memory_Info_Window"> Auto Position Memory Info Window </h4>
<br>The setting of the Auto Position Memory Info option in the Configuration dialog determines the default setting of the
 Auto Position Info feature in the Memory Display window.
<br><br>In the Memory Display window, activating the Auto Position Info feature ensures that the information box is always
 attached to the window.&nbsp; When deactivated, the Handle Information or Selector Information dialog box moves separately
 from the Memory Display window.&nbsp; You can turn on the auto position feature by selecting Auto Position Info from the
 File menu on the Memory Display window.
<h4 id="Display_Resources"> Display Resources </h4>
<br>When the Display Resources option is activated, Heap Walker displays a graphical image when you open the memory display
 window for an object that represents a graphical resource.
<h3 id="Heap_Walker__Saving_the_Current_Configuration"> Heap Walker:&nbsp; Saving the Current Configuration </h3>
<br>Normally, Heap Walker saves the configuration information, such as the window size and position, only when the application
 closes.&nbsp; Choosing the Save Current Configuration item from the File menu of the Heap Walker window causes Heap Walker
 to save the current configuration information.&nbsp; This saves the main window and Memory Display window sizes and positions,
 even if the Save Main window size/position and the Save Memory window size/position options in the Configuration dialog box
 are not selected.
<h3 id="Heap_Walker__Setting_the_Font"> Heap Walker:&nbsp; Setting the Font </h3>
<br>The Font item in the File menu allows you to set the font, style, and size for the text in all Heap Walker windows.&nbsp;
 This item opens the Font dialog box.&nbsp; Select the desired font details and click on OK to close the dialog and apply
 the fonts.
<h2 id="Walking_the_Global_Heap"> Walking the Global Heap </h2>
<br>There are four lists of information you can display in the Heap Walker window.&nbsp; The Display menu allows you to choose
 a list to be displayed.&nbsp; The lists Heap Walker can display are:
<dl>
<dt>Entire Heap
<dd>All of the memory objects on the global heap
<dt><br>Free Items
<dd>All of the objects that are not currently allocated
<dt><br>LRU Items
<dd>The least recently used list items
<dt><br>Selector List
<dd>All valid selectors
</dl>
<h3 id="The_Entire_Heap"> The Entire Heap </h3>
<br>Choosing Entire Heap from the Display menu displays a list of all the global heap in the Heap Walker window.&nbsp; The
 global heap is a pool of memory set aside by the system from which all program memory is allocated.
<br><br><tt><img src="hw3.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 3.</i></b><b><i></i></b><b> Choosing the Entire Heap item displays the global heap.</b>
<br><br>The following are the column headings that appear when the selected display is Entire Heap, Free Items, or LRU Items.
<dl>
<dt>Handle
<dd>An identifier assigned by the operating system to each object on the global heap
<dt><br>Address
<dd>The physical address in memory of the first byte in the object
<dt><br>Size
<dd>The total number of bytes occupied by the object
<dt><br>Owner
<dd>The module that owns the memory
<dt><br>Flags
<dd>An indicator specifying the type of the object.&nbsp; The codes are F (fixed memory) and D (discardable memory).&nbsp; A blank
 indicates that Heap Walker is unable to determine if the object is fixed or discardable.
<dt><br>Lock
<dd>An identifier indicating if there is a lock on the object.&nbsp; L1 indicates there is a lock on the memory; P1 indicates
 there is a page lock on the object; a blank indicates there is no lock on the object.
<dt><br>Heap
<dd>An indicator specifying if the object has a local heap.&nbsp; The code Y indicates that the object has a local heap; a blank
 field indicates there is no local heap.
<dt><br>Type
<dd>An indicator specifying the type of information in the object
</dl>
<h3 id="Free_Items_List"> Free Items List </h3>
<br>The Free Items list contains all objects on the global heap that are currently unallocated.&nbsp; Viewing the Free Items
 list allows you to see how fragmented your free memory is.&nbsp; The Free Items list appears under the same column headings
 as The Entire Heap list.
<h3 id="LRU_Items_List"> LRU Items List </h3>
<br>The LRU Items list contains all items in the system that are currently available to be discarded.&nbsp; The system discards
 memory when there is not enough free memory to satisfy an allocation request from a program.&nbsp; Memory is discarded based
 on a least recently used algorithm.
<br><br>Only the LRU list can be sorted by age.&nbsp; When sorted this way the objects appear in order from newest to oldest.
&nbsp; This means the first object on the list will be the last item to be discarded.&nbsp; This allows you to see the order
 in which the system will discard objects.
<br><br>To sort the LRU list, refer to the section <a href="#Sorting_the_Lists">Sorting the Lists</a>.
<br><br>The LRU Items list appears under the same column headings as The Entire Heap list.
<h3 id="The_Selector_List"> The Selector List </h3>
<br>The selector list displays all valid ring three selectors in the system.&nbsp; This list also shows descriptor table information
 about each selector.
<br><br><tt><img src="hw4.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 4.</i></b><b><i></i></b><b> The Selector List displays all valid ring three selectors.</b>
<br><br>You can view the data accessible by a selector by double clicking on its entry in the list.&nbsp; When you do this
 a Memory Display window appears.&nbsp; Attached to this window is a Selector Information dialog box that contains the information
 about the chosen selector that was displayed in the selector list.
<br><br>The following are the column headings that appear when the Selector List is displayed.
<dl>
<dt>Sel
<dd>The selector that information on this line refers to
<dt><br>Base
<dd>The lowest linear address accessible using this selector
<dt><br>Limit
<dd>The number of bytes of memory that this selector allows you to access.&nbsp; The greatest linear address accessible using
 this selector is<b> Base</b> plus the<b> Limit.</b>&nbsp; (i.e.&nbsp; &lt;sel&gt;:&lt;limit&gt;)
<dt><br>Gran
<dd>The granularity of the selector
<dt><br>Type
<dd>A value indicating if this selector provides execute access.&nbsp; This value contains the value<b> code</b> if execute access
 is provided.&nbsp; Otherwise the field contains<b> data.</b>
<dt><br>DPL
<dd>The privilege level for this selector.&nbsp; This determines the privilege level that a task requires to access this memory.
<dt><br>Access
<dd>The operations that are allowed on memory using this selector.&nbsp; The codes in this field are R (read), W (write), and
 Ex (execute).
<dt><br>Big
<dd>A code indicating if the selector's B flag (bit 54) is set.&nbsp; A<b> Y</b> in this column indicates the flag is set.&nbsp;
 A blank indicates the flag is not set.
</dl>
<h2 id="Sorting_the_Lists"> Sorting the Lists </h2>
<br>The items that appear in the Sort menu depend on the list selected from the Display menu.&nbsp; The Sort items allows
 you to organize the displayed information, making objects easier to find.&nbsp; There are two ways to sort information in
 Heap Walker.
<ul>
<li>Choose the desired sort method from the Sort menu
<br><br>or
<li>Click once on the column heading by which you want to sort.
</ul>
<br>Only those headings appearing in the Sort menu change the organization of the displayed information when selected.
<br><br>The following is a list of the headings by which you can sort the displayed information.&nbsp; Some headings have
 a secondary sort feature.&nbsp; For example, when you sort by Type, Heap Walker first sorts the Type field alphabetically,
 then organizes objects of the same Type by Owner.&nbsp; Where applicable, the secondary sort appears in parentheses.
<br><br>For the Entire Heap, Free Items, and LRU Items lists:
<ul>
<li>Address
<li>Handle
<li>Owner (secondary sort=Type)
<li>Size
<li>Type (secondary sort=Owner)
<li>Flag
<li>Age (available for LRU Items list only)
</ul>
<br>For the Selector List
<ul>
<li>Base Address
<li>Selector
<li>Limit
<li>Granularity
<li>Type
<li>DPL
</ul>
<h2 id="Viewing_the_Contents_of_Memory"> Viewing the Contents of Memory </h2>
<br>You can view the data stored in an object that appears in one of the lists displayed in the Heap Walker window by double
 clicking on the desired object.&nbsp; This opens a Memory Display window for the object.
<h3 id="The_Memory_Display_Window"> The Memory Display Window </h3>
<br><tt><img src="hw5.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 5.</i></b><b><i></i></b><b> The Memory Display window displays the data stored in the selected object.</b>
<br><br>The Memory Display window displays all of the data stored in the selected object.&nbsp; The data in this window appears
 in hexadecimal form.&nbsp; The Memory Window is useful because it allows you to see if the data in memory is what you believe
 it should be.&nbsp; Heap Walker cannot display the Memory Display window for free items or objects whose size equals zero.
<br><br>When you size the Memory Display window Heap Walker automatically reformats the information so that it is the same
 width as the window.
<br><br>Some memory objects contain information representing graphical objects used by Windows, such as menus, dialogs, cursors,
 and icons.&nbsp; When you display the data for one of these objects in the Memory Display window, Heap Walker also displays
 the object in graphical form.&nbsp; Occasionally, this operation may fail for different reasons, including lack of memory
 and the inability to read certain resource formats.
<br><br>If the object displayed is a menu then Heap Walker can tell you the constant associated with any item in the menu.
&nbsp; When the menu is displayed in graphical form simply select an item from it.&nbsp; Heap Walker will display a dialog
 that shows the name of the item selected and the numeric constant associated with it.&nbsp; This numeric constant is the
 number passed as the wparam parameter of a window's callback function when the menu item is selected.
<br><br>The Memory Display window is accompanied by an Information dialog box.&nbsp; This section describes the Information
 dialog, as well as the various functions you can perform within the Memory Display window.&nbsp; Functions include saving,
 setting the display, and setting the offset.
<h4 id="Saving_Heap_Walker_Information_to_a_File"> Saving Heap Walker Information to a File </h4>
<br>The Save items in Heap Walker allow you to save the information displayed in a window to a text file.&nbsp; Saving information
 to a file allows you to do many things, including:
<ul>
<li>print the output later
<li>compare objects outside of Heap Walker
<li>annotate the text file on-line
</ul>
<br>Choosing Save from the File menu on the Memory Display window saves the data in the window to a file name generated by
 Heap Walker based on the information in the Configuration dialog.&nbsp; A message box appears indicating the path to which
 Heap Walker saved the file.
<br><br>Choosing Save As from the File menu allows you to specify the file to which you want to save the data currently in
 the window.&nbsp; This opens a Save As dialog box where you select the desired file.&nbsp; Click on OK when completed.&nbsp;
 A message box appears indicating the path to which Heap Walker saved the file.
<h4 id="Changing_the_Heap_Walker_Display"> Changing the Heap Walker Display </h4>
<br>There are five ways to display the information in the Memory Display window.&nbsp; You can display the information as:
<ul>
<li>Bytes
<li>Words
<li>DWords
<li>16-bit Code
<li>32-bit Code
</ul>
<br>To change the form of the displayed data, select an item from the Display menu.
<br><br>When displaying data in bytes, the data appears in the window as it physically appears in memory.&nbsp; When the data
 is displayed as words, the bytes in memory are interpreted for you so that the values displayed are those that would be obtained
 by treating the memory as an array of words.&nbsp; For example, if memory containing the values:
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp; 12 34 56 78 9A BC DE FF</tt>
<br><br>was shown as words, the memory window would display:
<br><br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp; 3412 7856 BC9A FFDE</tt>
<br><br>A similar interpretation is performed when the data is displayed as DWords.&nbsp; If the above memory was shown as
 DWords, the memory window would display:
<br><br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp; 78563412 FFDEBC9A</tt>
<br><br>This rearrangement of bytes does not affect the textual interpretation of the data shown on the right hand side of
 the window.
<br><br>Selecting 16 or 32 Bit Code from the Display menu presents the data in a disassembled form.&nbsp; Sometimes presenting
 the data in disassembled form is not accurate.&nbsp; This is because when Heap Walker disassembles the data it begins at
 the first byte of the memory block and disassembles it linearly.&nbsp; If a byte in this block, such as a padding byte, throws
 off the sequence, the disassembly will be meaningless.
<h4 id="Setting_the_Offset_in_the_Memory_Display_Window"> Setting the Offset in the Memory Display Window </h4>
<br>In the Memory Display window, selecting the Set Offset item from the menu bar allows you to reposition the data so that
 the specified line appears at the top of the window.&nbsp; The offset you enter appears on the first line.&nbsp; It will
 not necessarily be the first piece of information because rounding often occurs to avoid breaking a line.
<dl>
<dt>(1)
<dd><b> Choose Set Offset</b> from the menu.
<br>This opens a Goto Offset dialog box.
<br><br><tt><img src="hw6.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 6.</i></b><b><i></i></b><b> In the Goto Offset dialog, enter the offset you want to appear at the top of
 the Memory Display window.</b>
<dt><br>(2)
<dd><b> Enter the desired offset</b> that you want to position at the top of the Memory Display window.&nbsp; You can enter the
 offset in decimal or hexadecimal form.&nbsp; However, you must prefix hexadecimal values with 0x (e.g.&nbsp; 0x00000005).
<dt><br>(3)
<dd><b> Click on OK.</b>
<br>This closes the dialog and positions the data as requested.
</dl>
<h4 id="Information_Dialog_Boxes"> Information Dialog Boxes </h4>
<br>A Handle Information dialog box attached to the Memory Display window provides the information that appears on the Heap
 Walker window for the displayed object.&nbsp; The information in this dialog is:
<ul>
<li>Block Address
<li>Block Handle
<li>Block Size
<li>Lock Count
<li>Page Lock Count
</ul>
<br><tt><img src="hw7.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 7.</i></b><b><i></i></b><b> The Handle Information dialog box displays information for the selected object.</b>
<br><br>When the selected display is the Selector List, the Selector Information dialog box is attached to the Memory Display
 window.&nbsp; The information in this dialog is:
<ul>
<li>Selector
<li>Base
<li>Limit
<li>Type
<li>DPL
<li>Granularity
<li>Access
</ul>
<br><tt><img src="hw8.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 8.</i></b><b><i></i></b><b> The Selector Information dialog displays the Selector List information for the
 selected object.</b>
<br><br>The information boxes stay with the Memory Display window when the Auto Position Info item under the File menu is
 checked.&nbsp; Uncheck this item by selecting it again from the File menu.
<br><br>If the information dialog is not visible, reveal it by choosing Show Info from the File menu on the Memory Display
 window.&nbsp; Close this dialog by double clicking on the system menu box in the upper left hand corner of the dialog.
<h2 id="Working_with_Individual_Objects"> Working with Individual Objects </h2>
<br>The items in the Object menu enable you to operate on the individual objects on the global heap.
<dl>
<dt><b>The Object Menu</b>
<dd>
<dt><br>Show
<dd>View the data stored in an object.
<dt><br>Get Selector
<dd>Show the Selector corresponding to a Handle.
<dt><br>Discard
<dd>Request that a discardable object be purged from memory.
<dt><br>Oldest
<dd>Reposition an object to become the oldest object on the LRU list.
<dt><br>Newest
<dd>Reposition an object to become the newest object on the LRU list.
<dt><br>Add
<dd>Calculate and display the amount of memory used by selected objects.
</dl>
<br>These items allow you to quickly set up test situations while developing a program.&nbsp; For example, if you suspect
 your program has a bug caused by the system discarding a particular object, you can use the Newest item to force the system
 to keep that object.&nbsp; Similarly, you can discard an object that you suspect is causing a bug to see if your program
 runs without it.
<br><br>Some items apply only to specific objects.&nbsp; To reposition and discard objects, the selected object must be a
 discardable item.&nbsp; When the Selector List is displayed only the Show item is available.
<h3 id="Viewing_an_Object_s_Memory"> Viewing an Object's Memory </h3>
<br>Viewing an object's memory is useful because it allows you to see if what is actually in memory is what you think should
 be in memory.&nbsp; There are two ways to view an object's memory:
<ul>
<li>Double click on the desired object
<br><br>or
<li>Click once on the desired object to select it and choose Show from the Object menu.
</ul>
<br>This opens a Memory Display window for the selected object.
<br><br>You can save the information on this window to a file and change the way in which the window displays the memory information.
&nbsp; Refer to the section <a href="#Viewing_the_Contents_of_Memory">Viewing the Contents of Memory</a> for details on these
 functions.
<h3 id="Finding_a_Selector"> Finding a Selector </h3>
<br>The Get Selector function locates the selector for any object with a handle.&nbsp; You need to know the selector to get
 the logical address in memory of an object.&nbsp; This function is not available for free items or objects without handles.
<br><br>To find the selector for an object:
<dl>
<dt>(1)
<dd><b> Click once on the object whose selector you want to find.</b>
<dt><br>(2)
<dd><b> Choose Get Selector</b> from the Object menu.
<br>This opens a message box which indicates the Selector that corresponds to the selected memory object.
<dt><br>(3)
<dd><b> Click on OK</b> to close the message box.
</dl>
<h3 id="Discarding_an_Object"> Discarding an Object </h3>
<br>The Discard item allows you to request that the system purge a discardable object from memory.&nbsp; Only objects marked
 by the operating system as discardable can be discarded.
<br><br>Choosing this item is equivalent to making the API call GlobalDiscard for the selected object.
<br><br>To discard an object:
<dl>
<dt>(1)
<dd><b> Click once on the object you want to discard.</b>
<dt><br>(2)
<dd><b> Choose Discard</b> from the Object menu.
<br>This opens a message box which indicates the Handle of the object discarded, as well as the number of bytes discarded.
<dt><br>(3)
<dd><b> Click on OK</b> to close the message box.
</dl>
<h3 id="Repositioning_an_Object"> Repositioning an Object </h3>
<br>Repositioning objects allows you to force discardable objects to be the oldest or newest object on the LRU list.&nbsp;
 The system discards objects from memory when there is not enough free memory available to satisfy an allocation request from
 a program.&nbsp; Giving an object the status Oldest ensures that if the system discards objects from memory, this will be
 the first object discarded.&nbsp; Giving an object the status Newest ensures that when the system removes memory, this will
 be the last object removed.
<br><br>To reposition an object:
<dl>
<dt>(1)
<dd><b> Click once on the object you want to reposition.</b>
<dt><br>(2)
<dd><b> Choose Oldest or Newest</b> from the Object menu, depending on how you want to reposition the object in the list.
<br>This opens a message box which indicates the handle of the object that has been repositioned in the selected manner.
<dt><br>(3)
<dd><b> Click on OK</b> to close the message box.
</dl>
<h3 id="Calculating_Memory_Size"> Calculating Memory Size </h3>
<br>The Add function is a summary function you use to calculate the memory size of selected objects.&nbsp; This function may
 be helpful in identifying memory leaks.
<br><br>A memory leak occurs when a program allocates memory but does not free it when the memory is no longer needed.&nbsp;
 If a program has a memory leak it requires increasingly more memory as it runs.&nbsp; With the Add function you can quickly
 determine the amount of memory being used by your program at any point in time.&nbsp; This allows you to determine if its
 memory requirements are increasing over time.
<br><br>Choosing Add from the Objects menu opens an Add dialog box.
<br><br><tt><img src="hw9.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 9.</i></b><b><i></i></b><b> As you select objects, the Add function calculates and displays the number of
 selected objects and their total size.</b>
<br><br>During an Add operation the global heap list acts as an extended selection list box.&nbsp; There are several ways
 to select objects in an extended selection list box.&nbsp; The following describes three common selection techniques you
 can use.
<ul>
<li>Select one object by clicking on it.&nbsp; The Add dialog displays the size of the selected item.
<li>Select multiple objects by holding the CTRL key and clicking on each object one at a time.&nbsp; The Add dialog displays
 the number of objects selected and the total size of those objects.
<li>Select many objects in a sequence by clicking on the first object and dragging the mouse while depressing the mouse button.
&nbsp; Release the mouse button when the last item in the sequence is highlighted.&nbsp; The Add dialog displays the number
 of objects selected and the total size of those objects.
</ul>
<h2 id="Walking_the_Local_Heap"> Walking the Local Heap </h2>
<br>A local heap is a pool of memory set aside by an individual program from which only that program can make allocations.
&nbsp; Looking at the local heap allows you to see how your program is using the memory it is taking from the local heap.
<br><br>All items in the Local menu relate to objects with local heaps, so are only functional with such objects.&nbsp; Objects
 marked with a Y in the Heap column have a local heap.
<h3 id="Monitoring_Data_Segment_Usage"> Monitoring Data Segment Usage </h3>
<br>Every Windows program has a default data segment.&nbsp; This block of memory contains the program's stack, local heap
 and the memory for any static or extern variables that it declares (static data).&nbsp; If a program requires enough static
 data that its default data segment grows beyond 64K then it must be recompiled for the large memory model and may encounter
 problems when more than one instance of the program run simultaneously.
<br><br>The Monitor Local Heap item allows you to see how memory in a program's default data segment is being used so you
 can optimize this by reducing the amount of stack space allocated to the minimum required or eliminate memory leaks that
 could drive up the amount of memory required by the local heap.
<br><br>When you choose the Monitor Local Heap item a Local Heap Monitor window is opened.&nbsp; This window contains a scale
 ranging from zero to the number of bytes in the selected data segment.&nbsp; The scale is divided into colored blocks which
 illustrate how the memory for the object is used.&nbsp; Uses include:
<dl>
<dt>Fixed heap
<dd>memory occupied by fixed objects on the program's local heap
<dt><br>Free heap
<dd>memory occupied by free objects on the program's local heap
<dt><br>Moveable heap
<dd>memory occupied by movable objects on the program's local heap
<dt><br>Stack allocated
<dd>memory allocated for use by the program's stack
<dt><br>Stack used
<dd>memory actually used by the program's stack since the program began execution
<dt><br>Static data
<dd>memory used by the program's static data
<dt><br>Unknown
<dd>memory for which Heap Walker cannot determine a use
</dl>
<br>Heap Walker updates this display continuously as memory usage changes.
<br><br>To view the usage of a program's default data segment:
<dl>
<dt>(1)
<dd><b> Click once on the object containing the default data segment</b> you want to monitor.
<br>This object will contain a local heap.&nbsp; A program's &quot;hInstance&quot; is the handle of its default data segment.
<dt><br>(2)
<dd><b> Choose Monitor Local Heap from the Local menu.</b>
<br>The Local Heap monitor window opens which displays the usage scale for the selected object.
<br><br><tt><img src="hw10.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 10.</i></b><b><i></i></b><b> The Local Heap Monitor window displays a scale indicating how the selected object
 is used.</b>
<dt><br>(3)
<dd><b> Double click on the system menu</b> to close the window.
</dl>
<h3 id="Local_Walk"> Local Walk </h3>
<br>Selecting the Local Walk item from the Local menu opens the Local Heap window for the selected object.
<br><br><tt><img src="hw11.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 11.</i></b><b><i></i></b><b> The Local Heap window displays the local heap for the selected object.</b>
<br><br>This window displays all objects on the selected object's local heap.&nbsp; Unlike the global heap, you cannot double
 click on the local heap objects to view the data they contain.
<br><br>The local heap window displays the following information:
<dl>
<dt>Offset
<dd>The number of bytes from the beginning of the object containing the local heap to the beginning of the object on the local
 heap
<dt><br>Handle
<dd>An identifier assigned by the operating system to each object on the local heap
<dt><br>Size
<dd>The total number of bytes occupied by the object
<dt><br>Flags
<dd>An indicator specifying the type of the object.&nbsp; The types are Free (unallocated object), Fixed (allocated object that
 has a fixed position on the local heap), and Moveable (allocated object that the operating system is able to reposition on
 the local heap).
<dt><br>Locks
<dd>The lock count for the object
<dt><br>Type
<dd>An indicator specifying the type of information in the object
</dl>
<br>There are two menus in this window:&nbsp; File and Sort.&nbsp; The File menu allows you to perform standard functions,
 including:
<ul>
<li>saving to a file (Save, Save As)
<li>closing the window (Exit)
</ul>
<br>Following are other functions you can perform in the Local Heap window.
<h4 id="Refresh_the_Heap"> Refresh the Heap </h4>
<br>The state of the local heap constantly changes as applications run.&nbsp; Selecting the Refresh Local List item in the
 File menu updates the information in the Local Heap window.
<h4 id="Display_Heap_Information"> Display Heap Information </h4>
<br>Selecting the Heap Info item in the File menu of the Local Heap window opens the Local Heap Information dialog box.
<br><br><tt><img src="hw12.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 12.</i></b><b><i></i></b><b> The Local Heap Information dialog displays summary information for the current
 local heap.</b>
<br><br>This dialog displays the count and size, in bytes, of the free, moveable, and fixed objects in the local heap for
 the selected object.
<br><br>Because the state of the local heap constantly changes, you can select the Refresh button on the dialog to update
 the local heap information.&nbsp; Click on OK to close the dialog.
<h4 id="Sorting_the_Local_Heap"> Sorting the Local Heap </h4>
<br>The Sort menu allows you to select the way Heap Walker displays the local heap information, making objects easier to find.
&nbsp; There are two ways to sort information in the local heap window:
<ul>
<li>Choose the desired sort method from the Sort menu
<br><br>or
<li>Click once on the column heading by which you want to sort.
</ul>
<br>Only those headings appearing in the Sort menu change the organization of the displayed information when selected.
<h3 id="Compact_and_Local_Walk"> Compact and Local Walk </h3>
<br>Selecting the Compact and Local Walk item compacts the local heap for the selected object.&nbsp; Once compacted, this
 function opens the Local Heap window.&nbsp; The functions available on this window are the same as for the Local Walk function.
&nbsp; This function is equivalent to making the API call LocalCompact(-1) and then selecting Local Walk from the Local menu.
<h3 id="GDI_Local_Walk"> GDI Local Walk </h3>
<br>GDI is the part of the Windows operating system responsible for drawing on the screen.&nbsp; Much of what a Windows program
 does involves drawing on the screen using objects such as device contexts, pens, and bitmaps.&nbsp; GDI is responsible for
 managing these objects.&nbsp; Memory for them is contained on the GDI Local Heap.&nbsp; Walking the GDI local Heap allows
 you to view the GDI objects that currently exist in the system.
<br><br>GDI objects are a limited resource in the system, so it is important that Windows applications use them wisely.&nbsp;
 Walking the GDI Local Heap allows you to monitor GDI object usage.
<br><br>To walk the GDI Local Heap choose GDI Local Walk from the Local menu.
<h3 id="USER_Local_Walk"> USER Local Walk </h3>
<br>USER is the part of the Windows operating system responsible for managing user interface objects such as windows, menus,
 and dialogs.&nbsp; Some memory associated with these objects is contained on the USER Local Heap.
<br><br>Space on the USER Local Heap is a limited resource in the system, so it is important that Windows applications use
 it wisely.&nbsp; Walking the USER Local Heap allows you to monitor usage of this space.
<br><br>To walk the USER Local Heap choose USER Local Walk from the Local menu.
<h2 id="Working_with_the_Global_Heap"> Working with the Global Heap </h2>
<br>The global heap is a pool of memory set aside by the system from which all program memory is allocated.&nbsp; There are
 five functions you can use to monitor and manipulate the Global Heap.&nbsp; This section describes these functions.
<h3 id="Refreshing_the_Global_Heap"> Refreshing the Global Heap </h3>
<br>As programs run, the state of the global heap changes.&nbsp; When you select the global heap window after a window belonging
 to another application has been active, Heap Walker automatically refreshes the displayed global heap information.
<br><br>Selecting the Refresh Global Heap item in the Global menu forces Heap Walker to update the displayed global heap information.
<h3 id="Compacting_the_Global_Heap"> Compacting the Global Heap </h3>
<br>Compacting the global heap creates larger blocks of free memory.&nbsp; The system automatically compacts the global heap
 when it needs memory.
<br><br>The Global Compact item in the Global menu allows you to manually force the system to compact the global heap.&nbsp;
 Selecting this item is equivalent to making the API call GlobalCompact(0).
<h3 id="Removing_Discardable_Objects"> Removing Discardable Objects </h3>
<br>Selecting the Global Compact and Discard item from the Global menu removes all discardable objects and compacts the free
 memory on the global heap.&nbsp; This allows you to create larger blocks of free memory.&nbsp; Selecting this item is equivalent
 to making the API call GlobalCompact(-1).
<h3 id="Viewing_the_Global_Heap_Summary"> Viewing the Global Heap Summary </h3>
<br>Selecting the Global Heap Info item from the Global Menu opens a Global Heap Information dialog box.&nbsp; This dialog
 summarizes global heap usage.
<br><br><tt><img src="hw13.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 13.</i></b><b><i></i></b><b> The Global Heap Information dialog provides a summary of global heap usage.</b>
<br><br>Information included on this dialog is:
<ul>
<li>Total Items on the Heap
<li>Number of Free Items
<li>Number of LRU Items
</ul>
<br>The state of the global heap changes as applications run.&nbsp; Select the Refresh button to update the global heap summary.
&nbsp; Click on OK to close the dialog.
<h3 id="Viewing_Memory_Management_Information"> Viewing Memory Management Information </h3>
<br>Selecting the Memory Management Info item from the Global menu opens a Memory Management Information dialog box.&nbsp;
 This dialog displays information regarding the state of the virtual memory manager.
<br><br><tt><img src="hw14.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 14.</i></b><b><i></i></b><b> The Memory Management Information dialog displays information regarding the
 state of the virtual memory manager.</b>
<br><br>Following is the information that appears on this dialog.
<dl>
<dt>Size of Linear Address Space (in pages)
<dd>The size of the total linear address space in pages
<dt><br>Free Pages in Linear Address Space
<dd>The amount of free memory, in pages, in the linear address space
<dt><br>System Page Size (in bytes)
<dd>The size, in bytes, of a page of memory
<dt><br>Pages in Swap File
<dd>The number of pages in the system swap file
<dt><br>Total Pages in System
<dd>The total number of pages managed by the virtual memory manager, including free, locked, and unlocked pages
<dt><br>Number of Unlocked Pages
<dd>The number of unlocked pages in the system, including free pages
<dt><br>Number of Free Pages
<dd>The number of pages in the system that are not currently in use
<dt><br>Largest Free Memory Block
<dd>The size, in bytes, of the largest free block of contiguous linear memory in the system
<dt><br>Maximum Allocatable Pages
<dd>The maximum number of pages that are available in the system for allocation
<dt><br>Maximum Lockable Pages
<dd>The maximum number of pages that are available in the system to be allocated and locked
</dl>
<br>The information displayed by this dialog changes as applications run.&nbsp; Click on the Refresh button to update the
 displayed information.&nbsp; Click on OK to close the Memory Management Information dialog.
<h2 id="Testing_with_Heap_Walker"> Testing with Heap Walker </h2>
<br>Heap Walker provides various allocation functions that allow you to test your programs.&nbsp; By allocating and freeing
 memory you can see how your program reacts in low memory situations.
<br><br>Each time you select the Alloc menu an Allocation Information dialog box appears on the screen.
<br><br><tt><img src="hw15.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 15.</i></b><b><i></i></b><b> The Allocation Information dialog provides approximate size information regarding
 allocated and free memory.</b>
<br><br>The information in this dialog includes Kilobytes allocated (approximately), Kilobytes free, and Bytes free.&nbsp;
 It is important to realize that the information appearing in this dialog is approximate.&nbsp; This information appear so
 you can monitor the approximate amounts of memory you have allocated using an Allocation function.&nbsp; You should use this
 information only when using an Allocation function.
<dl>
<dt>Important:
<dd>Do not use the Allocation functions under the Windows Debug Kernel as they can make your system unstable.
</dl>
<h3 id="Allocate_All_Memory"> Allocate All Memory </h3>
<br>To see how your program runs when all free memory is allocated, choose Allocate All Memory from the Alloc menu.&nbsp;
 Choosing this item may change the appearance and performance of your application.&nbsp; This is normal because when there
 is little memory available, the system may discard fonts that Heap Walker is using and swap information to disk more frequently.
<h3 id="Free_All_Memory"> Free All Memory </h3>
<br>Selecting the Free All Memory item frees all of the allocated memory.&nbsp; This returns to the system the memory taken
 away using other Allocation functions.
<h3 id="Other_Allocation_Functions"> Other Allocation Functions </h3>
<br>The final three allocation functions-Allocate all but, Allocate, and Free-allow you to choose an amount of memory to allocate
 or free.&nbsp; Perform these functions as follows:
<dl>
<dt>(1)
<dd><b> Choose the desired function</b> from the Alloc menu.
<dt><br>(2)
<dd><b> Choose the desired amount of memory</b> that you want to allocate, free, or leave unallocated.
<br>For all functions, an n amount is available.&nbsp; Selecting this item closes the Allocation Information dialog box and
 opens a separate dialog box displaying the following information:
<ul>
<li>K Allocated (approx.)
<li>K free (approx.)
<li>Bytes Free
</ul>
<br><tt><img src="hw16.bmp" style="vertical-align:middle"></tt>
<br><b><i>Figure 16.</i></b><b><i></i></b><b> On the allocation dialog box, enter the desired amount of memory to allocate,
 free, or leave unallocated.</b>
<dt><br>(3)
<dd><b> In this dialog, enter the specific number of bytes to Allocate</b> all but, Allocate, or Free.
<br>The system interprets the entered value as bytes, unless you follow the value with a K, in which case the value is read
 as kilobytes.&nbsp; You can enter Hexadecimal values by prefixing them with 0x.
<dt><br>(4)
<dd><b> Click on OK</b> to process the request and close the dialog.
</dl>
</body>
